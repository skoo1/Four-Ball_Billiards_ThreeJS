<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>KBilliards — 4-Ball Carom</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { overflow: hidden; background: #1a1a2e; font-family: 'Segoe UI', sans-serif; }
  canvas#three-canvas { display: block; }

  /* Top bars */
  #info-bar {
    position: fixed; top: 0; left: 0; right: 0;
    padding: 6px 14px; background: rgba(0,0,0,0.7);
    color: #aaa; font-size: 13px; z-index: 10;
    text-align: center;
  }
  #status-bar {
    position: fixed; top: 28px; left: 0; right: 0;
    padding: 4px 14px; background: rgba(0,0,0,0.5);
    color: #eee; font-size: 14px; z-index: 10;
    text-align: center;
  }

  /* Game score / turn */
  #game-ui {
    position: fixed; top: 60px; left: 14px;
    background: rgba(0,0,0,0.6); padding: 10px 16px;
    border-radius: 8px; color: #fff; font-size: 14px;
    z-index: 10; display: none;
  }
  #game-ui .score-line { margin: 3px 0; }
  #game-ui .turn-line { margin-top: 6px; color: #ffd700; font-weight: bold; }

  /* Power bar */
  #power-bar-container {
    position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
    width: 300px; height: 18px; background: rgba(0,0,0,0.6);
    border: 1px solid #555; border-radius: 9px; z-index: 10;
    display: none; overflow: hidden;
  }
  #power-bar-fill {
    height: 100%; width: 0%;
    background: linear-gradient(90deg, #4caf50, #ffeb3b, #f44336);
    border-radius: 9px; transition: width 0.05s linear;
  }

  /* Result popup */
  #result-text {
    position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
    font-size: 36px; font-weight: bold; color: #fff;
    text-shadow: 0 0 20px rgba(0,0,0,0.8);
    z-index: 20; display: none;
    pointer-events: none;
    animation: fadeOut 2s forwards;
  }
  @keyframes fadeOut {
    0% { opacity: 1; } 70% { opacity: 1; } 100% { opacity: 0; }
  }

  /* ── Hit-point indicator (bottom-right) ── */
  #hitpoint-panel {
    position: fixed; bottom: 60px; right: 20px;
    z-index: 10; display: none;
    text-align: center;
  }
  #hitpoint-title {
    color: #fff; font-size: 12px; margin-bottom: 4px;
  }
  #hitpoint-area {
    position: relative; width: 120px; height: 120px;
    margin: 0 auto;
  }
  #hitpoint-circle {
    width: 120px; height: 120px; border-radius: 50%;
    background: rgba(230,230,230,0.2);
    border: 2px solid rgba(255,255,255,0.4);
    cursor: crosshair; position: relative;
  }
  #hitpoint-dot {
    position: absolute; width: 10px; height: 10px;
    border-radius: 50%; background: #f44;
    left: 55px; top: 55px;
    pointer-events: none;
  }
  .hp-label {
    position: absolute; color: rgba(255,255,255,0.5);
    font-size: 11px; pointer-events: none;
  }
  .hp-top  { top: 2px;   left: 50%; transform: translateX(-50%); }
  .hp-bot  { bottom: 2px; left: 50%; transform: translateX(-50%); }
  .hp-left { left: 4px;  top: 50%; transform: translateY(-50%); }
  .hp-right{ right: 4px; top: 50%; transform: translateY(-50%); }

  /* ── Physics params panel (right side) ── */
  #params-panel {
    position: fixed; top: 60px; right: 10px;
    width: 230px; background: rgba(0,0,0,0.65);
    border-radius: 6px; padding: 8px 0;
    z-index: 10; color: #fff; font-size: 12px;
    font-family: 'Consolas', 'Courier New', monospace;
    user-select: none;
  }
  #params-panel.hidden { display: none; }
  .params-header {
    text-align: center; color: #0ff; font-size: 13px;
    font-weight: bold; padding: 2px 0 4px;
  }
  .params-hint {
    text-align: center; color: #888; font-size: 10px;
    padding: 0 8px 6px; line-height: 1.4;
  }
  .param-row {
    display: flex; justify-content: space-between;
    padding: 4px 10px; cursor: pointer;
    background: rgba(255,255,255,0.03);
    border-left: 3px solid transparent;
  }
  .param-row:hover { background: rgba(255,255,255,0.08); }
  .param-row.selected {
    background: rgba(255,255,0,0.15);
    border-left-color: #ffd700;
  }
  .param-label { color: #ccc; }
  .param-value { color: #ffd700; font-weight: bold; }
  .params-footer {
    text-align: center; color: #666; font-size: 10px;
    padding: 6px 0 2px;
  }

  /* Cue info text */
  #cue-info {
    position: fixed; bottom: 54px; left: 50%; transform: translateX(-50%);
    color: #ccc; font-size: 13px; z-index: 10;
    font-family: 'Consolas', monospace;
    background: rgba(0,0,0,0.4); padding: 2px 12px;
    border-radius: 4px; display: none;
    white-space: nowrap;
  }

  /* Advanced Command Panel */
  #adv-panel {
    position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
    width: 600px; background: rgba(20,20,40,0.95);
    border: 1px solid #555; border-radius: 8px;
    padding: 16px; z-index: 30; display: none;
    color: #ddd; font-size: 13px;
  }
  #adv-panel h3 { margin-bottom: 8px; color: #ffd700; }
  #adv-input {
    width: 100%; height: 80px; background: #111; color: #0f0;
    border: 1px solid #444; border-radius: 4px;
    font-family: 'Consolas', monospace; font-size: 13px;
    padding: 8px; resize: vertical;
  }
  #adv-hint {
    margin-top: 8px; color: #888; font-size: 11px; line-height: 1.5;
  }

  /* Button bar */
  #button-bar {
    position: fixed; bottom: 6px; right: 14px;
    z-index: 10; display: flex; gap: 6px;
  }
  #button-bar button {
    padding: 5px 12px; background: rgba(255,255,255,0.15);
    border: 1px solid rgba(255,255,255,0.3); border-radius: 4px;
    color: #ddd; font-size: 12px; cursor: pointer;
  }
  #button-bar button:hover { background: rgba(255,255,255,0.3); }
</style>
</head>
<body>

<div id="info-bar">[1-5] Scenario  [G] Game  [T] Practice  [R] Reset  [P] Params  [Shift+A] Adv</div>
<div id="status-bar"></div>

<div id="game-ui">
  <div class="score-line" id="player-score">Player: 0</div>
  <div class="score-line" id="ai-score">AI: 0</div>
  <div class="turn-line" id="turn-display"></div>
</div>

<div id="power-bar-container">
  <div id="power-bar-fill"></div>
</div>

<div id="result-text"></div>

<div id="hitpoint-panel">
  <div id="hitpoint-title">Hit Point (WASD / Drag)</div>
  <div id="hitpoint-area">
    <div id="hitpoint-circle">
      <span class="hp-label hp-top">Top</span>
      <span class="hp-label hp-bot">Bot</span>
      <span class="hp-label hp-left">L</span>
      <span class="hp-label hp-right">R</span>
      <div id="hitpoint-dot"></div>
    </div>
  </div>
</div>

<div id="params-panel" class="hidden">
  <div class="params-header">Physics Params [P]</div>
  <div class="params-hint">Click row, ] up, [ down, Shift=fine<br>Shift+P = Reset all</div>
  <div id="params-rows"></div>
  <div class="params-footer">Shift+P = Reset defaults</div>
</div>

<div id="cue-info">
  Az: 0.0° El: 0.0° Tip: (0.000, 0.000)
</div>

<div id="adv-panel">
  <h3>Advanced Command Panel</h3>
  <textarea id="adv-input" spellcheck="false"></textarea>
  <div id="adv-hint">
    Ctrl+Enter = Execute &nbsp; Esc = Close<br>
    {"cmd":"set","balls":{"white":{"pos":[0.0,-0.6]}}}<br>
    {"cmd":"shot","ball":"white","azimuth":0,"tip":[0,0.5],"power":35}
  </div>
</div>

<div id="button-bar">
  <button onclick="sendKey('g')">Game (G)</button>
  <button onclick="sendKey('t')">Practice (T)</button>
  <button onclick="sendKey('r')">Reset (R)</button>
</div>

<script type="importmap">
{
  "imports": {
    "three": "https://cdn.jsdelivr.net/npm/three@0.162.0/build/three.module.js",
    "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.162.0/examples/jsm/"
  }
}
</script>
<script type="module" src="/static/app.js"></script>
<script>
  function sendKey(k) {
    if (window._sendKey) window._sendKey(k);
  }
</script>
</body>
</html>
